---
title: "Running the Windows desktop in the background of GO-Global sessions"
linkTitle: ""
weight: 11
type: "docs"
---
Windowsアプリケーションの中には、Windowsデスクトップ（explorer.exe）で提供される機能やサービスを使用するものがあります。ほとんどのアプリケーションはデスクトップがなくても動作しますが、デスクトップがアプリケーションと同じセッションで実行されていないと、起動できなかったり、正常に動作しなかったりするものがあります。デフォルトでは、GO-Globalのセッションではデスクトップは実行されません。GO-Global セッションでアプリケーションが起動しない、または正しく動作しない場合は、デスクトップに依存している可能性があります。

### GO-Globalセッションで実行するWindowsデスクトップ（explorer.exe）を登録する方法

1. レジストリエディタで、HKEY_LOCAL_MACHINEキーを展開します。
2. \SOFTWARE\GraphOn\GO-Global\System\Run\LocalMachineを展開します。
3. DWORD値を作成し、名前をexplorer.exeとします。
4. 値を0に設定します。

この設定を行うと、GO-Globalセッションでデスクトップが実行されますが、表示されません。

{{% alert title="参照" color="info" %}}
GO-Globalセッションのバックグラウンドで実行するためにWindowsデスクトップを登録すると、大きなオーバーヘッドが発生します。セッションの開始に時間がかかり、より多くのメモリを消費するようになります。また、デスクトップの起動時に実行するために登録された他のプロセスによってもオーバーヘッドが発生します。不要なプロセスがユーザのスタートアップフォルダやレジストリの実行コマンド（HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Runなど）に登録されないように注意してください。Explorer.exeは、ユーザがホストに初めてサインオンしたときに、セッション内で実行されます。これは、ユーザプロファイルを完全に初期化するために行われます。Explorer.exeは、上記のように設定されていない限り、同じホスト上で同じユーザが開始した以降のセッションでは実行されません。
{{% /alert %}}

## システムプロセスの登録
GO-Globalアーキテクチャでは、1つのセッション内で複数のプロセスを実行できます。常に最低1つのプロセスが実行されている必要があります。すべてのプロセスが終了すると、GO-Globalセッションが閉じられ、すべてのリソースが割り当て解除され、クライアント接続が切断されます。

通常のプログラムの実行中に、ほとんどのアプリケーションでは、外部操作を実行するための子プロセスが作成されます。これらのアプリケーションの中には、例えばWindowsヘルプなど、独自のユーザインターフェイスを提供するものがあり、必要なくなるとユーザによって閉じられます。他には、ユーザインターフェイスを提供せず、固定の操作を行ってから終了するヘルパープロセスもあります。アプリケーションは、終了する前に作成した子プロセスを制御して終了させることもできます。

問題は、プロセスがユーザインターフェースを持たず、自分自身で終了せず、親プロセスが直接終了させない場合にまれに発生します。既定の構成では、これらのプロセスは、他のすべてのプロセスが終了すると、ハングした GO-Globalセッションを作成します。残りのプロセスはセッションをアクティブに保ちますが、クライアントにはセッションを完全に閉じるためのユーザインターフェイスがありません。

この問題を解決するために、GO-Globalホストでは、システムプロセスとして実行する特定の実行可能ファイルの登録をサポートしています。セッション内に残っているプロセスがシステムプロセスのみの場合、GO-Globalセッションは終了します。

ほとんどのアプリケーションでは、デフォルトの構成で十分です。プロセスが終了する手段を持たずに作成された特別なケースでは、待機中のプロセスの実行可能ファイルを登録することで、GO-Globalセッションを適切に終了させることができます。

{{% alert title="警告" color="Alert" %}}
以下の情報には、Windowsレジストリを開いて操作することが含まれています。ここで説明されている操作以外の操作を行うと、構成エラーが発生し、システムが使用できなくなる可能性があります。レジストリを操作する際には、細心の注意を払ってください。
{{% /alert %}}

### 実行ファイルをヘルパープロセスとして登録する方法

1. レジストリエディタ(regedit.exe)を実行します。
2. HKEY_LOCAL_MACHINE\Software\GraphOn\GO-Global\System\Processesにブラウズする。
3. 登録する実行ファイルの名前(例えば、AGENTSVR.EXEもしくはC:\example1\testapp.exeとC:\example2\testapp.exe)のDWORDエントリを作成する。フルパスを含めることで、同じ実行イメージでもバージョンによって実行内容が異なります。
4. 新しいエントリの値を0に設定します。
5. レジストリエディタを閉じます。

この設定は、将来のセッションに加えて、現在のすべてのGO-Globalセッションに影響します。これには、すでに「ハング」状態にあるセッションは含まれません。このようなセッションは、Admin Consolから終了する必要があります。