---
title: "Application Host Manager Recovery"
linkTitle: ""
weight: 10
type: "docs"
---
Application Publishing Serviceは、サービスに障害が発生した場合に自動的に再起動するように設定できます。たとえば、Application Publishing ServiceがRelay Load Balancer上で停止すると、クライアントは切断されますが、Relay Load Balancerに接続されていたDependent Hosts上ではセッションは継続して実行されます。これらの従属ホストは、15秒ごとにRelay Load Balancerへの再接続を試みます。Dependent HostsがRelay Load Balancerに再接続すると、Relay Load Balancerにセッションを再追加し、切断されたセッションに関連付けられたすべての状態情報を復元します。これにより、クライアントは自分のセッションに再接続できます。

デフォルトでは、クライアントは自動的にアプリケーションホストマネージャへの再接続を5回試みます。より高いサービス可用性を提供するために、フェイルオーバーアプリケーションホストマネージャを設定することができます。

### To configure a Failover Application Host Manager 

1. GO-Globalホストをアプリケーションホストマネージャと同じネットワーク上の別のコンピュータにインストールします。このコンピュータがフェイルオーバーアプリケーションホストマネージャになります。すべてのクライアントおよびDependent Hosts(またはファームマネージャ)は、フェイルオーバーアプリケーションホストマネージャに接続できる必要があります。
2. GO-Globalホストをアプリケーションホストマネージャとして実行するように設定します。
	a. コンピュータ上で **Admin Console** を実行します。
	b. [Tools | Host Options]をクリックします。
	c. [Configuration]タブをクリックします。 
	d. アプリケーションホストマネージャをクリックします。 
	e. プライマリのアプリケーションホストマネージャがRelay Load Balancerの場合は、Relay Load Balancerをクリックします。
	f. OK をクリックします。 
	g. Application Publishing Serviceを再起動します。
3. プライマリアプリケーションホストマネージャから公開アプリケーションをエクスポートし、フェイルオーバーアプリケーションホストマネージャにインポートします。:<br>
	a. プライマリアプリケーションホストマネージャで、管理者としてRegeditを実行してください。
	b. 以下のレジストリキーを選択してください：`\HKEY_LOCAL_MACHINE\GraphOn\GO-Global\AppServer`<br>
	c. ファイル｜エクスポート...**をクリックします。
	d. ファイルの名前を入力します(例: Appserver.reg)。
	e. 保存」をクリックします。
	f. このファイルをフェイルオーバーアプリケーションホストマネージャにコピーします。
    	g. ファイルをダブルクリックします。
	h. はい」をクリックして、ファイルをインポートします。
	i. OKをクリックします。
4. また、「Failover Relay Load Balancer」に接続できない場合は、「Failover Relay Load Balancer」に接続するように各依存ホストを設定します。
	a. 管理者コンソールを実行します。
	b. <br> [ツール] > [ホストオプション]をクリックします。
	c. 
	d. リレーロードバランサーのアドレス**には、両方のリレーロードバランサーのアドレスを、完全修飾ドメイン名と一緒に入力します。プライマリリレーロードバランサーのアドレスを最初に入力し、セミコロンを続けて入力し、その後にフェイルオーバーリレーロードバランサーのアドレスを入力します。例：primary_relay_load_balancer.graphon.com;failover_relay_load_balancer.graphon.com<br
	e. OKをクリックします。
5. 5. クライアントの起動に使用するURLとショートカットに、プライマリとフェイルオーバーの両方のRelay Load Balancerのアドレスを指定します。
	a. <br> <br> ブラウザ経由で接続するユーザーには、**host** パラメータにプライマリリレーサーバーのアドレスを設定し、その後にセミコロン、その後にフェイルオーバーリレーサーバーのアドレスを設定した HTML ページまたは URL を提供します。
	b. b. インストールされたクライアントを介して接続するユーザーに、**-h**コマンドライン引数をプライマリリレーサーバーのアドレスに等しくし、セミコロンの後にフェイルオーバーリレーサーバーのアドレスを続くように設定するショートカットを提供します(例: -h primary_relay_load_balancer_address;failover_relay_load_balancer_address).<br>。

この構成では、プライマリのRelay Load Balancerが何らかの理由で障害を起こした場合、従属ホストとクライアントは自動的にフェイルオーバーサーバに再接続し、ユーザーは通常、プライマリのRelay Load Balancerが障害を起こしてから1～2分以内にセッションに再接続されます。これを下図に示します。

![5-10-1](/img/5-10-1.png) 

同様に、ファームマネージャの構成では、ファームマネージャが何らかの理由で障害を起こすと、ファームホストとクライアントは自動的にフェイルオーバーのファームマネージャに再接続し、ユーザーは通常、ファームマネージャの障害発生から1～2分以内にセッションに再接続されます。これを下図に示します。

![5-10-2](/img/5-10-2.png) 
<br> <br>ユーザーのセッションが自動的に再接続に失敗した場合は、クライアントのURL、ウェブページ、ショートカットのautoreconnectパラメータの値を5よりも大きい値（デフォルト）にしてください。

フェイルオーバーリレーロードバランサーがアクティブな場合（つまり、依存ホストがフェイルオーバーリレーロードバランサーに接続されている場合）、ユーザーのセッションの開始に時間がかかります。このため、プライマリのリレーロードバランサーは、オンラインになったら再起動してください。プライマリのリレーロードバランサーを再起動するには、ユーザーがクラスタに接続する可能性が低い時間帯に、Task Managerを使用してフェイルオーバーのリレーロードバランサーのaps.exeプロセスを終了します。フェールオーバーのリレーロードバランサーでaps.exeプロセスが終了すると、従属ホストとクライアントはプライマリのリレーロードバランサーに再接続します。<br> <br>クラスターの依存ホストがプライマリのRelay Load Balancerに再接続した後、フェイルオーバーのRelay Load Balancer上でApplication Publishing Serviceを再起動してください。

{{% alert title="参照" color="info" %}}
Service経由でリレーロードバランサー上で**Application Publishing Service**を停止または再起動すると、**GO-Globalはリレーロードバランサーの従属ホスト上で実行中のすべてのセッションを閉じます。したがって、クラスタの依存ホスト上でセッションが実行されているときにプライマリのリレーロードバランサーを再アクティベートする必要がある場合は、フェイルオーバーのリレーロードバランサー上でサービスを介してアプリケーションパブリッシングサービスを再起動しないで、代わりに、上述のようにタスクマネージャを使用してフェイルオーバーのリレーロードバランサー上でapps.exeプロセスを終了します。
{{% /alert %}}
